<?xml version="1.0" encoding="UTF-8"?>
<project default="dist" name="dist">

  <!-- Common build instructions -->
  <property name="jo.basedir" value="${basedir}/.."/>
  <import file="${jo.basedir}/ant/jo-common.xml"/>

  <target name="dist">
    <!-- Check dist variable is set -->
    <fail unless="dist" message=".">

Error: dist variable is not set, run ant like this:
  ant -Ddist=0.4.2
    </fail>
    <!-- Clean all, also old dist-->
    <ant inheritAll="false" target="clean" antfile="${jo.basedir}/build.xml"/>
    <!-- Build and test all -->
    <ant inheritAll="false" antfile="${jo.basedir}/build.xml"/>
    <!-- Create dir for new dist -->
    <mkdir dir="build"/>
    <!-- Recreate jar with better manifest and right name -->
    <copy file="${install.dir}/javaoctave.jar" tofile="build/javaoctave-${dist}.jar"/>
    <jar destfile="build/javaoctave-${dist}.jar" update="true">
      <manifest>
        <attribute name="Version" value="${dist}"/>
        <attribute name="Project-Url" value="http://kenai.com/projects/javaoctave/"/>
      </manifest>
    </jar>
    <javadoc sourcepath="${jo.basedir}/javaoctave/src" destdir="build/javadoc" classpathref="pathid.lib.jars"/>
  </target>

</project>
